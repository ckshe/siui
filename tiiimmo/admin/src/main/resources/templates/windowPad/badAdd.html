<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <title>添加不良</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
      <link rel="stylesheet" href="../../lib/layui-v2.3.0/css/layui.css">
      <style type="text/css">
		.label_width {
			width: 100px;
		}
        #testEquipment input{
            padding-left: 0px!important;
            border: 1px solid rgb(255, 255, 255)!important;
        }
        .xm-select-dl{
            height: 200px!important;
        }
      </style>
  </head>
  <body>
        <form class="layui-form" style="padding-top:20px;" lay-filter="form2">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">板编号<span style="color:red">*</span></label>
                    <div class="layui-input-inline">
                        <input type="text" id="plateNo" name="taskSerial" placeholder="扫码录入板编号" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label"></label>
                    <div class="layui-input-inline">
                        <input type="hidden" id="imConfigId">
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">检验人</label>
                    <div class="layui-input-inline">
                        <input id="user" type="text" name="user"  autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">登记时间<span style="color:red">*</span></label>
                    <div class="layui-input-inline">
                        <input id="inspectionTime" type="text" name="time"  autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
            <div class="layui-form-item" id="badBox">
                <div class="layui-inline" >
                    <label class="layui-form-label">不良描述</label>
                    <div class="layui-input-inline" >
                        <div id="badSay" style="display: none; width:518px!important;border:1px solid #e6e6e6;color:#666;min-height:30px;padding:10px" ></div>
                        <div id="badCheck" style="width:518px">
                            <input class="check" type="checkbox" value="无" lay-filter="bad" lay-skin="primary" title="无">
                            <input class="check" type="checkbox" value="缺模" lay-filter="bad" lay-skin="primary" title="缺模">
                            <input class="check" type="checkbox" value="粘模" lay-filter="bad" lay-skin="primary" title="粘模">
                            <input class="check" type="checkbox" value="缩水" lay-filter="bad" lay-skin="primary" title="缩水">
                            <input class="check" type="checkbox" value="烧胶" lay-filter="bad" lay-skin="primary" title="烧胶">
                            <input class="check" type="checkbox" value="披峰" lay-filter="bad" lay-skin="primary" title="披峰">
                            <input class="check" type="checkbox" value="孔偏" lay-filter="bad" lay-skin="primary" title="孔偏">
                            <input class="check" type="checkbox" value="孔大" lay-filter="bad" lay-skin="primary" title="孔大">
                            <input class="check" type="checkbox" value="孔小" lay-filter="bad" lay-skin="primary" title="孔小">
                            <input class="check" type="checkbox" value="堵孔、穿孔" lay-filter="bad" lay-skin="primary" title="堵孔、穿孔">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline" >
                    <label class="layui-form-label">补充说明</label>
                    <div class="layui-input-inline" >
                        <input class="layui-input" name="remark" placeholder="补充说明" style="width:518px!important;" autocomplete="off" />
                    </div>
                </div>
            </div>
            <div class="layui-form-item" style="text-align: center;">
                <button class="layui-btn" type="button" lay-submit lay-filter="add">保存</button>
                <button class="layui-btn layui-btn-normal" type="reset" >重置</button>
            </div>
      </form>
    <script src="../../lib/layui-v2.3.0/layui.js" ></script>
        <script src="../../js/common.js" ></script>
        <script type="text/javascript">
        var a='';
        layui.use(['form','layer','laydate','jquery'], function(){
          var form = layui.form,
          	layer = layui.layer,
          	laydate = layui.laydate,
            $ = layui.jquery;
            laydate.render({
              elem: '#inspectionTime',
              type: 'datetime'
            });
            var badCheck = document.getElementById('badCheck');
            http.get('/base/badNews/findBadNewsList',function (res) {
               if(res.code===200){
                   var str = "";
                   res.data.forEach(function (t) {
                       str+='<input type="checkbox" value="'+t.bad_name+'" lay-filter="bad" lay-skin="primary" title="'+t.bad_name+'">'
                   });
                   badCheck.innerHTML=str;
                   form.render()
               }
            });
            scanCode('plateNo');
            $('#user').on('click',function () {
                var userBox =  layer.open({
                    title:'用户列表',
                    type:2,
                    area:['98%',"94%"],
                    content:'/userTable'
                });
                a=function (data) {
                    layer.close(userBox);
                    var d=data[0];
                    form.val('form2',{user:d.nickname})

                }
            });
            form.on('submit(add)', function (obj) {
                var checkeds = badCheck.getElementsByTagName('input');
                var arr = [];
                for(var i=0; i<checkeds.length;i++){
                    if(checkeds[i].checked){
                        arr.push({badNews:checkeds[i].value})
                    }
                }
                obj.field.badNewsList=arr;
                $.ajax({
                    url:"/produce/pcbTask/findProcessTaskByDevice",
                    type:'post',
                    dataType : "json",
                    data : JSON.stringify({
                        deviceCode:getQueryString2('deviceCode'),
                    }),
                    contentType : "application/json;charset=UTF-8",
                    success: function (res) {
                        layer.closeAll();
                        res.data.some(function (t,i) {
                            if(t.is_now_flag==1){
                                obj.field.pcbTaskCode=t.pcb_task_code;
                                $.ajax({
                                    url: "/produce/pcbTask/recordBadTypeList",
                                    type: "POST",
                                    contentType: "application/json",
                                    data: JSON.stringify(obj.field),
                                    dataType: "json",
                                    success: function (res) {
                                        if (res.code === 200) {
                                            layer.alert(res.msg, { icon: 1 });
                                        }else{
                                            layer.alert(res.msg)
                                        }
                                    }
                                });
                                return
                            }
                        });
                    }
                });


            });

        });
    </script>
  </body>

</html>